# =====================================================
# RIFFLE – ENVIRONMENT CONFIGURATION TEMPLATE
# =====================================================
# Usage:
#   Copy this file to one of the following:
#     .env.dev
#     .env.test
#     .env.stage
#     .env.prod
#
# Environment model:
#   dev / test   → no TLS, no mTLS
#   stage        → TLS + mTLS (pre-prod)
#   prod         → TLS + mTLS + tuning
# =====================================================


# -----------------------------------------------------
# PROJECT (all environments)
# -----------------------------------------------------
COMPOSE_PROJECT_NAME=riffle            # dev: riffle-dev | test: riffle-test
DOCKER_STAGE=dev                       # dev | test | stage | prod


# -----------------------------------------------------
# RUNTIME / APP (all environments)
# -----------------------------------------------------
NODE_ENV=development                   # dev: development | test: test | stage: staging | prod: production
PORT=1968
JWT_SECRET=change_me                   # REQUIRED (secret, env-specific)

CORS_ORIGIN=http://localhost:5173

RIFFLE_API_KEY=change_me               # REQUIRED (secret, env-specific)
DEEZER_API_KEY=change_me               # REQUIRED (secret, env-specific)


# -----------------------------------------------------
# CLIENT (VITE) (all environments)
# -----------------------------------------------------
VITE_API_URL=http://localhost:1968     # prod may differ


# -----------------------------------------------------
# EDGE & INFRA DISCOVERY (all environments)
# -----------------------------------------------------
# Internal Docker / cluster DNS names
WAF_HTTP_URL=http://infra-waf:80
WAF_HTTPS_URL=https://infra-waf:443

KONG_PROXY_URL=http://infra-kong:8000
KONG_ADMIN_URL=http://infra-kong:8001
KONG_MANAGER_URL=http://infra-kong:8002
KONG_STATUS_URL=http://infra-kong:8100


# -----------------------------------------------------
# INTERNAL SERVICES (all environments)
# -----------------------------------------------------
CORE_API_URL=http://service-core-api:1968
MATCHMAKER_URL=http://service-matchmaker:8080
STORE_SERVICE_URL=http://service-store:3000
MUSIC_SERVICE_URL=http://service-music:3000
WORKER_URL=http://service-worker:3000


# -----------------------------------------------------
# ZERO TRUST (stage / prod only)
# -----------------------------------------------------
MTLS_ENABLED=false                     # stage/prod: true
MTLS_CA_PATH=/app/certs/ca.crt
MTLS_CERT_PATH=/app/certs/client.crt
MTLS_KEY_PATH=/app/certs/client.key


# -----------------------------------------------------
# DATABASE – POSTGRES (APP)
# -----------------------------------------------------
POSTGRES_START_CMD=postgres             # stage/prod: SSL-enabled command
POSTGRES_HOST=store-game-pg
POSTGRES_PORT=5432
POSTGRES_DB=riffle_db
POSTGRES_USER=riffle_user
POSTGRES_PASSWORD=change_me             # REQUIRED (secret, env-specific)
POSTGRES_SSL_MODE=disable               # stage/prod: require


# -----------------------------------------------------
# DATABASE – POSTGRES (KONG) (all environments)
# -----------------------------------------------------
KONG_PG_HOST=store-kong-pg
KONG_PG_DB=kong
KONG_PG_USER=kong
KONG_PG_PASSWORD=change_me              # REQUIRED (secret, env-specific)


# -----------------------------------------------------
# CACHE – REDIS
# -----------------------------------------------------
# dev / test  → plain TCP
# stage/prod → TLS-only startup command
REDIS_START_CMD=redis-server --port 6379 --aclfile /etc/redis/users.acl

GAME_REDIS_HOST=active-game-redis
GAME_REDIS_PORT=6379
GAME_REDIS_TLS=0                        # stage/prod: 1

KONG_REDIS_HOST=cache-kong-redis
KONG_REDIS_PORT=6379


# -----------------------------------------------------
# WORKERS / TRANSPORT SECURITY
# -----------------------------------------------------
WORKER_DB_SSL=false                     # stage/prod: true
WORKER_REDIS_TLS=false                  # stage/prod: true


# -----------------------------------------------------
# BACKUPS
# -----------------------------------------------------
BACKUP_SCHEDULE="0 3 * * *"
BACKUP_KEEP_DAYS=7
BACKUP_SSL_MODE=disable                 # prod: require


# -----------------------------------------------------
# KONG – TUNING (stage/prod only)
# -----------------------------------------------------
KONG_WORKERS=auto
